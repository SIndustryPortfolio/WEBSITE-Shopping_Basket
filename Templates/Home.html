<!-- MODULES -->
{% include "Handlers/Topbar.html" %}

<!-- CORE -->
<script>
    window.Config["Products"] = [];

    let ProductInfo, ItemsInBasket;

    {% for Product in Products %}

        ProductInfo = {{ Product.GetDict(JSON=True) | tojson }};
        ItemsInBasket = {{Basket.GetItemsFromName(Product["Name"], JSON=True) | tojson}};

        ProductInfo["ImportedQuantity"] = ItemsInBasket.length;

        window.Config["Products"].push(ProductInfo);
    {% endfor %}

    console.log(window.Config["Products"]);
</script>

<body>
    <div class="Content">
        <div class="container text-center">
            <div class="container">
                <div class="row">
                    <div class="col-5" style="">
                        <div class="card shadow-md" style="width: 100%; margin: 0 auto;">
                            <div class="card-header">
                                <h2>üß∫ Your basket</h2>
                            </div>

                            <div class="card-body">
                                <table id="UserBasketTable" class="table table-striped">
                                    <tr>
                                        <th>Product Name</th>
                                        <th>Quantity</th>
                                    </tr>

                                    {#
                                        {% for Product in Basket.GetDict()["Items"] %}
                                            {% if not Product["Name"] in AlreadyChecked %}
                                                <tr>
                                                    <td>{{Product["Name"]}}</td>
                                                    <td>{{Product["ImportedQuantity"]}}</td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    #}
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col" style="">
                        
                    </div>
                    <div class="col-5" style="">
                        <div class="card shadow-md" style="width: 100%; margin: 0 auto;">
                            <div class="card-header">
                                <h2>üõçÔ∏è Catalogue</h2>
                            </div>
                            <div class="card-body">
                                <table class="table table-striped">
                                    <tr>
                                        <th>Name</th>
                                        <th>Price</th>
                                        <th>Offers</th>
                                        <th>Quantity</th>
                                    </tr>

                                    {% for Product in Products %}
                                        <tr>
                                            {% set ProductInfo=Product.GetDict() %}

                                            <td>{{ProductInfo["Name"]}}</td>
                                            <td>{{CoreInfo["Currency"]["Prefix"] + Utilities.FormatNumber(ProductInfo["Price"])}}</td>
                                            
                                            <td>
                                                {% if "Offers" in ProductInfo %}
                                                    <ul>
                                                        {% for OfferName in ProductInfo["Offers"] %}
                                                            <li><b>{{OfferName}}</b></li>
                                                        {% endfor %}
                                                    </ul>
                                                {% else %}
                                                    {{"X"}}
                                                {% endif %}
                                            </td>

                                            <td>
                                                <div class="row text-center align-items-center" id="Product{{ProductInfo['Name']}}Quantity">
                                                    <div class="col" style="width: 30%; padding: 3%">
                                                        <button name="subtract" class="btn btn-danger" style="width: 100%; height: 100%; padding: 0;">-</button>
                                                    </div>
                                                    <div class="col" style="width: 30%; padding: 3%;">
                                                        <p name="Quantity"></p>
                                                    </div>
                                                    <div class="col" style="width: 30%; padding: 3%">
                                                        <button name="add" class="btn btn-success" style="width: 100%; height: 100%; padding: 0;">+</button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>

                            <form id="UpdateBasketForm" class="text-center" action="UpdateBasket" method="post" style="padding-bottom: 10px;">
                                <input type="submit" class="btn btn-secondary" value="Update"/>
                            </form>

                            <form id="ResetBasketForm" class="text-center" action="ResetBasket" method="post" style="padding-bottom: 10px;">
                                <input type="submit" class="btn btn-danger" value="Reset"/>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <br>

        
        <div class="card shadow-sm" style="width: 18rem; margin: 0 auto;">
            <div class="card-header">
                <h2 class="card-title text-center">üí∞ Costs</h2>
            </div>
            <div class="card-body">
                <h4 class="card-text">Subtotal: {{CoreInfo["Currency"]["Prefix"]}} {{Costs["SubTotal"]}}</h4>
                <h4 class="card-text">Discount: {{CoreInfo["Currency"]["Prefix"]}} -{{Costs["PriceReduction"]}}</h4>
                <hr class="rounded">
                <h4 class="card-text">Total: {{CoreInfo["Currency"]["Prefix"]}} {{Costs["Total"]}}</h4>
            </div>
        </div>

        <!--<div class="container text-center">
            <h2 class="text-center">üí∞ Costs</h2>
            <h4 class="text-center">Subtotal: {{CoreInfo["Currency"]["Prefix"]}} {{Costs["SubTotal"]}}</h4>
            <h4 class="text-center">Discount: {{CoreInfo["Currency"]["Prefix"]}} {{Costs["PriceReduction"]}}</h4>
            <h4 class="text-center">Total: {{CoreInfo["Currency"]["Prefix"]}} {{Costs["Total"]}}</h4>
            <br>
        </div>-->
    </div>
</body>